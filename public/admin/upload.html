<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸Šä¼ æ¸¸æˆ - AI Stone æ¸¸æˆå¯¼èˆª</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <header class="main-header">
    <h1 class="site-title">AI Stone æ¸¸æˆå¯¼èˆª - ä¸Šä¼ æ¸¸æˆ</h1>
    <nav class="main-nav">
      <a href="/">é¦–é¡µ</a>
      <a href="/favorites.html">æ”¶è—å¤¹</a>
      <a href="/admin/index.html" class="active">ç®¡ç†</a>
      <button id="toggleLang">English</button>
    </nav>
  </header>
  
  <div class="admin-container">
    <!-- ç™»å½•æ£€æŸ¥æç¤º -->
    <div id="loginAlert" class="alert alert-warning" style="display: none;">
      æ‚¨éœ€è¦å…ˆç™»å½•æ‰èƒ½è®¿é—®æ­¤é¡µé¢ã€‚<a href="/admin/index.html">å‰å¾€ç™»å½•</a>
    </div>
    
    <!-- ä¸Šä¼ è¡¨å• -->
    <div id="uploadPanel" class="admin-panel" style="display: none;">
      <h2 class="admin-title">ä¸Šä¼ æ–°æ¸¸æˆ</h2>
      
      <div id="alertContainer"></div>
      
      <form id="uploadForm" class="admin-form">
        <!-- æ¸¸æˆåŸºæœ¬ä¿¡æ¯ -->
        <div class="form-group">
          <label for="gameTitle">æ¸¸æˆæ ‡é¢˜ï¼ˆä¸­æ–‡ï¼‰</label>
          <input type="text" id="gameTitle" class="form-control" required>
          <span class="form-hint">è¾“å…¥æ¸¸æˆçš„ä¸­æ–‡æ ‡é¢˜</span>
        </div>
        
        <div class="form-group">
          <label for="gameTitleEn">æ¸¸æˆæ ‡é¢˜ï¼ˆè‹±æ–‡ï¼‰</label>
          <input type="text" id="gameTitleEn" class="form-control" required>
          <span class="form-hint">è¾“å…¥æ¸¸æˆçš„è‹±æ–‡æ ‡é¢˜</span>
        </div>
        
        <div class="form-group">
          <label for="gameDescription">æ¸¸æˆæè¿°ï¼ˆä¸­æ–‡ï¼‰</label>
          <textarea id="gameDescription" class="form-control" required></textarea>
          <span class="form-hint">ç®€è¦æè¿°æ¸¸æˆå†…å®¹å’Œç©æ³•</span>
        </div>
        
        <div class="form-group">
          <label for="gameDescriptionEn">æ¸¸æˆæè¿°ï¼ˆè‹±æ–‡ï¼‰</label>
          <textarea id="gameDescriptionEn" class="form-control" required></textarea>
          <span class="form-hint">æ¸¸æˆæè¿°çš„è‹±æ–‡ç‰ˆæœ¬</span>
        </div>
        
        <div class="form-group">
          <label for="gameCategory">æ¸¸æˆåˆ†ç±»</label>
          <select id="gameCategory" class="form-control" required>
            <option value="">-- é€‰æ‹©åˆ†ç±» --</option>
            <option value="all">æ‰€æœ‰æ¸¸æˆ</option>
            <option value="action">åŠ¨ä½œæ¸¸æˆ</option>
            <option value="puzzle">ç›Šæ™ºæ¸¸æˆ</option>
            <option value="strategy">ç­–ç•¥æ¸¸æˆ</option>
          </select>
          <span class="form-hint">é€‰æ‹©æœ€åˆé€‚çš„æ¸¸æˆåˆ†ç±»</span>
        </div>
        
        <!-- æ¸¸æˆé“¾æ¥ -->
        <div class="form-group">
          <label for="gameUrl">æ¸¸æˆé“¾æ¥ (iframe URL)</label>
          <input type="url" id="gameUrl" class="form-control" required>
          <span class="form-hint">è¾“å…¥å¯ä»¥é€šè¿‡iframeåµŒå…¥çš„æ¸¸æˆURLï¼Œæ¨èä½¿ç”¨httpsé“¾æ¥</span>
        </div>
        
        <!-- æ¸¸æˆç¼©ç•¥å›¾ä¸Šä¼  -->
        <div class="form-group">
          <label>æ¸¸æˆç¼©ç•¥å›¾</label>
          <div id="thumbnailUpload" class="upload-area">
            <div class="upload-icon">ğŸ“·</div>
            <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </p>
            <p class="form-hint">æ¨èå°ºå¯¸ï¼š300Ã—200pxï¼ŒPNGæˆ–JPGæ ¼å¼</p>
            <input type="file" id="thumbnailInput" class="file-input" accept="image/*">
          </div>
          <div id="thumbnailPreview" class="preview-container"></div>
        </div>
        
        <!-- æäº¤æŒ‰é’® -->
        <div class="form-group">
          <button type="submit" class="btn btn-primary" id="submitBtn">æ·»åŠ æ¸¸æˆ</button>
          <button type="button" class="btn btn-secondary" style="margin-left: 10px;" onclick="location.href='/admin/index.html'">è¿”å›</button>
        </div>
      </form>
    </div>
  </div>
  
  <script src="/js/app.js"></script>
  <script>
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
      
      if (!isLoggedIn) {
        // æœªç™»å½•ï¼Œæ˜¾ç¤ºè­¦å‘Š
        document.getElementById('loginAlert').style.display = 'block';
      } else {
        // å·²ç™»å½•ï¼Œæ˜¾ç¤ºä¸Šä¼ è¡¨å•
        document.getElementById('uploadPanel').style.display = 'block';
        
        // åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
        initUploadForm();
      }
      
      // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢æŒ‰é’®
      const toggleLangButton = document.getElementById('toggleLang');
      if (toggleLangButton) {
        toggleLangButton.addEventListener('click', toggleLanguage);
      }
    });
    
    /**
     * åˆå§‹åŒ–ä¸Šä¼ è¡¨å•
     */
    function initUploadForm() {
      // ç¼©ç•¥å›¾ä¸Šä¼ åŒºç‚¹å‡»äº‹ä»¶
      const thumbnailUpload = document.getElementById('thumbnailUpload');
      const thumbnailInput = document.getElementById('thumbnailInput');
      
      thumbnailUpload.addEventListener('click', function() {
        thumbnailInput.click(); // è§¦å‘æ–‡ä»¶é€‰æ‹©æ¡†
      });
      
      // ç›‘å¬æ–‡ä»¶é€‰æ‹©
      thumbnailInput.addEventListener('change', function(e) {
        handleFiles(e.target.files);
      });
      
      // æ‹–æ”¾äº‹ä»¶å¤„ç†
      thumbnailUpload.addEventListener('dragover', function(e) {
        e.preventDefault();
        thumbnailUpload.classList.add('dragover');
      });
      
      thumbnailUpload.addEventListener('dragleave', function() {
        thumbnailUpload.classList.remove('dragover');
      });
      
      thumbnailUpload.addEventListener('drop', function(e) {
        e.preventDefault();
        thumbnailUpload.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
      });
      
      // è¡¨å•æäº¤å¤„ç†
      const uploadForm = document.getElementById('uploadForm');
      uploadForm.addEventListener('submit', handleSubmit);
    }
    
    /**
     * å¤„ç†é€‰æ‹©çš„æ–‡ä»¶
     * @param {FileList} files - é€‰æ‹©çš„æ–‡ä»¶åˆ—è¡¨
     */
    function handleFiles(files) {
      if (!files || files.length === 0) return;
      
      const file = files[0]; // åªå¤„ç†ç¬¬ä¸€ä¸ªæ–‡ä»¶
      
      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.type.startsWith('image/')) {
        showAlert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶', 'danger');
        return;
      }
      
      // éªŒè¯æ–‡ä»¶å¤§å° (é™åˆ¶ä¸º2MB)
      if (file.size > 2 * 1024 * 1024) {
        showAlert('å›¾ç‰‡æ–‡ä»¶ä¸èƒ½è¶…è¿‡2MB', 'danger');
        return;
      }
      
      // é¢„è§ˆå›¾ç‰‡
      const previewContainer = document.getElementById('thumbnailPreview');
      previewContainer.innerHTML = ''; // æ¸…ç©ºç°æœ‰é¢„è§ˆ
      
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';
      
      const img = document.createElement('img');
      img.src = URL.createObjectURL(file);
      img.onload = function() {
        URL.revokeObjectURL(this.src); // é‡Šæ”¾å†…å­˜
      };
      
      const removeBtn = document.createElement('div');
      removeBtn.className = 'preview-remove';
      removeBtn.textContent = 'Ã—';
      removeBtn.addEventListener('click', function(e) {
        e.stopPropagation(); // é˜»æ­¢å†’æ³¡
        previewContainer.innerHTML = ''; // ç§»é™¤é¢„è§ˆ
        document.getElementById('thumbnailInput').value = ''; // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
      });
      
      previewItem.appendChild(img);
      previewItem.appendChild(removeBtn);
      previewContainer.appendChild(previewItem);
    }
    
    /**
     * å¤„ç†è¡¨å•æäº¤
     * @param {Event} e - æäº¤äº‹ä»¶
     */
    function handleSubmit(e) {
      e.preventDefault();
      
      // è·å–è¡¨å•æ•°æ®
      const formData = {
        id: generateId(document.getElementById('gameTitleEn').value),
        title: {
          zh: document.getElementById('gameTitle').value,
          en: document.getElementById('gameTitleEn').value
        },
        description: {
          zh: document.getElementById('gameDescription').value,
          en: document.getElementById('gameDescriptionEn').value
        },
        iframeUrl: document.getElementById('gameUrl').value,
        category: document.getElementById('gameCategory').value,
        active: true,
        dateAdded: new Date().toISOString()
      };
      
      // è·å–ç¼©ç•¥å›¾æ–‡ä»¶
      const thumbnailInput = document.getElementById('thumbnailInput');
      const thumbnailFile = thumbnailInput.files[0];
      
      // éªŒè¯å¿…å¡«å­—æ®µ
      if (!formData.title.zh || !formData.title.en || !formData.description.zh || 
          !formData.description.en || !formData.iframeUrl || !formData.category) {
        showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'danger');
        return;
      }
      
      // è¿™é‡Œåº”è¯¥æœ‰æ–‡ä»¶ä¸Šä¼ å’Œæ•°æ®ä¿å­˜çš„é€»è¾‘
      // ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯çº¯å‰ç«¯æ–¹æ¡ˆï¼Œè¿™é‡Œä»…æ¨¡æ‹Ÿä¿å­˜è¿‡ç¨‹
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      const submitBtn = document.getElementById('submitBtn');
      const originalBtnText = submitBtn.textContent;
      submitBtn.textContent = 'ä¿å­˜ä¸­...';
      submitBtn.disabled = true;
      
      // æ¨¡æ‹Ÿä¿å­˜æ“ä½œ
      setTimeout(function() {
        // è·å–ç°æœ‰æ¸¸æˆæ•°æ®
        const currentGames = JSON.parse(localStorage.getItem('customGames') || '[]');
        
        // æ·»åŠ æ–°æ¸¸æˆ
        currentGames.push(formData);
        
        // ä¿å­˜å›localStorage
        localStorage.setItem('customGames', JSON.stringify(currentGames));
        
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        submitBtn.textContent = originalBtnText;
        submitBtn.disabled = false;
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showAlert('æ¸¸æˆå·²æˆåŠŸæ·»åŠ ï¼', 'success');
        
        // é‡ç½®è¡¨å•
        document.getElementById('uploadForm').reset();
        document.getElementById('thumbnailPreview').innerHTML = '';
      }, 1500);
    }
    
    /**
     * ä»æ¸¸æˆæ ‡é¢˜ç”ŸæˆID
     * @param {string} title - æ¸¸æˆæ ‡é¢˜
     * @returns {string} ç”Ÿæˆçš„ID
     */
    function generateId(title) {
      // å°†æ ‡é¢˜è½¬ä¸ºå°å†™ï¼Œå¹¶åˆ é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œç”¨è¿å­—ç¬¦æ›¿æ¢ç©ºæ ¼
      const id = title.toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-');
      
      // æ·»åŠ æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§
      return id + '-' + Date.now().toString(36);
    }
    
    /**
     * æ˜¾ç¤ºæé†’æ¶ˆæ¯
     * @param {string} message - æ¶ˆæ¯æ–‡æœ¬
     * @param {string} type - æ¶ˆæ¯ç±»å‹ (success, danger, warning, info)
     */
    function showAlert(message, type) {
      const alertContainer = document.getElementById('alertContainer');
      
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      
      // æ·»åŠ å…³é—­æŒ‰é’®
      const closeBtn = document.createElement('span');
      closeBtn.style.float = 'right';
      closeBtn.style.cursor = 'pointer';
      closeBtn.textContent = 'Ã—';
      closeBtn.addEventListener('click', function() {
        alert.remove();
      });
      
      alert.appendChild(closeBtn);
      alertContainer.prepend(alert);
      
      // 5ç§’åè‡ªåŠ¨å…³é—­
      setTimeout(function() {
        if (alert.parentNode) {
          alert.remove();
        }
      }, 5000);
    }
    
    /**
     * åˆ‡æ¢ç•Œé¢è¯­è¨€
     */
    function toggleLanguage() {
      // è·å–å½“å‰è¯­è¨€
      let currentLang = localStorage.getItem('locale') || 'zh';
      
      // åˆ‡æ¢è¯­è¨€
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('locale', currentLang);
      
      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      document.getElementById('toggleLang').textContent = currentLang === 'zh' ? 'English' : 'ä¸­æ–‡';
      
      // æ›´æ–°ç•Œé¢æ–‡æœ¬
      updateUIText();
    }
    
    /**
     * æ›´æ–°ç•Œé¢æ–‡æœ¬
     */
    function updateUIText() {
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      const translations = {
        zh: {
          'site.title': 'AI Stone æ¸¸æˆå¯¼èˆª - ä¸Šä¼ æ¸¸æˆ',
          'upload.title': 'ä¸Šä¼ æ–°æ¸¸æˆ',
          'login.required': 'æ‚¨éœ€è¦å…ˆç™»å½•æ‰èƒ½è®¿é—®æ­¤é¡µé¢ã€‚',
          'login.link': 'å‰å¾€ç™»å½•',
          'form.game.title.zh': 'æ¸¸æˆæ ‡é¢˜ï¼ˆä¸­æ–‡ï¼‰',
          'form.game.title.zh.hint': 'è¾“å…¥æ¸¸æˆçš„ä¸­æ–‡æ ‡é¢˜',
          'form.game.title.en': 'æ¸¸æˆæ ‡é¢˜ï¼ˆè‹±æ–‡ï¼‰',
          'form.game.title.en.hint': 'è¾“å…¥æ¸¸æˆçš„è‹±æ–‡æ ‡é¢˜',
          'form.game.desc.zh': 'æ¸¸æˆæè¿°ï¼ˆä¸­æ–‡ï¼‰',
          'form.game.desc.zh.hint': 'ç®€è¦æè¿°æ¸¸æˆå†…å®¹å’Œç©æ³•',
          'form.game.desc.en': 'æ¸¸æˆæè¿°ï¼ˆè‹±æ–‡ï¼‰',
          'form.game.desc.en.hint': 'æ¸¸æˆæè¿°çš„è‹±æ–‡ç‰ˆæœ¬',
          'form.game.category': 'æ¸¸æˆåˆ†ç±»',
          'form.game.category.hint': 'é€‰æ‹©æœ€åˆé€‚çš„æ¸¸æˆåˆ†ç±»',
          'form.game.category.select': '-- é€‰æ‹©åˆ†ç±» --',
          'form.game.url': 'æ¸¸æˆé“¾æ¥ (iframe URL)',
          'form.game.url.hint': 'è¾“å…¥å¯ä»¥é€šè¿‡iframeåµŒå…¥çš„æ¸¸æˆURLï¼Œæ¨èä½¿ç”¨httpsé“¾æ¥',
          'form.game.thumbnail': 'æ¸¸æˆç¼©ç•¥å›¾',
          'form.game.thumbnail.drag': 'ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ ',
          'form.game.thumbnail.hint': 'æ¨èå°ºå¯¸ï¼š300Ã—200pxï¼ŒPNGæˆ–JPGæ ¼å¼',
          'form.submit': 'æ·»åŠ æ¸¸æˆ',
          'form.cancel': 'è¿”å›',
          'alert.fill.required': 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ',
          'alert.image.type': 'è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶',
          'alert.image.size': 'å›¾ç‰‡æ–‡ä»¶ä¸èƒ½è¶…è¿‡2MB',
          'alert.success': 'æ¸¸æˆå·²æˆåŠŸæ·»åŠ ï¼',
          'btn.saving': 'ä¿å­˜ä¸­...',
          'nav.home': 'é¦–é¡µ',
          'nav.favorites': 'æ”¶è—å¤¹',
          'nav.admin': 'ç®¡ç†'
        },
        en: {
          'site.title': 'AI Stone Game Navigation - Upload Game',
          'upload.title': 'Upload New Game',
          'login.required': 'You need to login first to access this page.',
          'login.link': 'Go to Login',
          'form.game.title.zh': 'Game Title (Chinese)',
          'form.game.title.zh.hint': 'Enter the Chinese title of the game',
          'form.game.title.en': 'Game Title (English)',
          'form.game.title.en.hint': 'Enter the English title of the game',
          'form.game.desc.zh': 'Game Description (Chinese)',
          'form.game.desc.zh.hint': 'Briefly describe the game content and gameplay',
          'form.game.desc.en': 'Game Description (English)',
          'form.game.desc.en.hint': 'English version of the game description',
          'form.game.category': 'Game Category',
          'form.game.category.hint': 'Select the most appropriate game category',
          'form.game.category.select': '-- Select Category --',
          'form.game.url': 'Game Link (iframe URL)',
          'form.game.url.hint': 'Enter a game URL that can be embedded via iframe, https recommended',
          'form.game.thumbnail': 'Game Thumbnail',
          'form.game.thumbnail.drag': 'Click or drag image here to upload',
          'form.game.thumbnail.hint': 'Recommended size: 300Ã—200px, PNG or JPG format',
          'form.submit': 'Add Game',
          'form.cancel': 'Cancel',
          'alert.fill.required': 'Please fill in all required fields',
          'alert.image.type': 'Please select a valid image file',
          'alert.image.size': 'Image file cannot exceed 2MB',
          'alert.success': 'Game has been successfully added!',
          'btn.saving': 'Saving...',
          'nav.home': 'Home',
          'nav.favorites': 'Favorites',
          'nav.admin': 'Admin'
        }
      };
      
      // è®¾ç½®é¡µé¢æ ‡é¢˜
      document.title = translations[currentLang]['site.title'];
      document.querySelector('.site-title').textContent = translations[currentLang]['site.title'];
      
      // æ›´æ–°å¯¼èˆªé“¾æ¥
      const navLinks = document.querySelectorAll('.main-nav a');
      navLinks[0].textContent = translations[currentLang]['nav.home'];
      navLinks[1].textContent = translations[currentLang]['nav.favorites'];
      navLinks[2].textContent = translations[currentLang]['nav.admin'];
      
      // æ›´æ–°ç™»å½•è­¦å‘Š
      if (document.getElementById('loginAlert')) {
        document.getElementById('loginAlert').innerHTML = 
          translations[currentLang]['login.required'] + 
          ` <a href="/admin/index.html">${translations[currentLang]['login.link']}</a>`;
      }
      
      // æ›´æ–°è¡¨å•æ ‡é¢˜å’Œå­—æ®µ
      document.querySelector('.admin-title').textContent = translations[currentLang]['upload.title'];
      
      // æ›´æ–°è¡¨å•æ ‡ç­¾å’Œæç¤º
      const labels = {
        'gameTitle': 'form.game.title.zh',
        'gameTitleEn': 'form.game.title.en',
        'gameDescription': 'form.game.desc.zh',
        'gameDescriptionEn': 'form.game.desc.en',
        'gameCategory': 'form.game.category',
        'gameUrl': 'form.game.url'
      };
      
      const hints = {
        'gameTitle': 'form.game.title.zh.hint',
        'gameTitleEn': 'form.game.title.en.hint',
        'gameDescription': 'form.game.desc.zh.hint',
        'gameDescriptionEn': 'form.game.desc.en.hint',
        'gameCategory': 'form.game.category.hint',
        'gameUrl': 'form.game.url.hint'
      };
      
      // æ›´æ–°è¡¨å•æ ‡ç­¾
      for (const [id, key] of Object.entries(labels)) {
        const label = document.querySelector(`label[for="${id}"]`);
        if (label) {
          label.textContent = translations[currentLang][key];
        }
      }
      
      // æ›´æ–°è¡¨å•æç¤º
      for (const [id, key] of Object.entries(hints)) {
        const hint = document.querySelector(`#${id} + .form-hint`);
        if (hint) {
          hint.textContent = translations[currentLang][key];
        }
      }
      
      // æ›´æ–°ç¼©ç•¥å›¾ä¸Šä¼ åŒºåŸŸæ–‡æœ¬
      const uploadTextElem = document.querySelector('.upload-text');
      if (uploadTextElem) {
        uploadTextElem.textContent = translations[currentLang]['form.game.thumbnail.drag'];
      }
      
      const thumbnailHint = document.querySelector('#thumbnailUpload .form-hint');
      if (thumbnailHint) {
        thumbnailHint.textContent = translations[currentLang]['form.game.thumbnail.hint'];
      }
      
      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      document.getElementById('submitBtn').textContent = translations[currentLang]['form.submit'];
      document.querySelector('.btn-secondary').textContent = translations[currentLang]['form.cancel'];
      
      // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
      const categorySelect = document.getElementById('gameCategory');
      categorySelect.options[0].text = translations[currentLang]['form.game.category.select'];
    }
  </script>
</body>
</html> 