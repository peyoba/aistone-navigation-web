<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¸æˆç®¡ç† - AI Stone æ¸¸æˆå¯¼èˆª</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <header class="main-header">
    <h1 class="site-title">AI Stone æ¸¸æˆå¯¼èˆª - æ¸¸æˆç®¡ç†</h1>
    <nav class="main-nav">
      <a href="/">é¦–é¡µ</a>
      <a href="/favorites.html">æ”¶è—å¤¹</a>
      <a href="/admin/index.html" class="active">ç®¡ç†</a>
      <button id="toggleLang">English</button>
    </nav>
  </header>
  
  <div class="admin-container">
    <!-- ç™»å½•æ£€æŸ¥æç¤º -->
    <div id="loginAlert" class="alert alert-warning" style="display: none;">
      æ‚¨éœ€è¦å…ˆç™»å½•æ‰èƒ½è®¿é—®æ­¤é¡µé¢ã€‚<a href="/admin/index.html">å‰å¾€ç™»å½•</a>
    </div>
    
    <!-- æ¸¸æˆç®¡ç†é¢æ¿ -->
    <div id="gamesPanel" class="admin-panel" style="display: none;">
      <h2 class="admin-title">æ¸¸æˆç®¡ç†</h2>
      
      <!-- æ“ä½œæ  -->
      <div class="admin-actions">
        <div class="search-box">
          <input type="text" id="searchGames" class="form-control" placeholder="æœç´¢æ¸¸æˆ...">
        </div>
        <div class="filter-box">
          <select id="categoryFilter" class="form-control">
            <option value="">å…¨éƒ¨åˆ†ç±»</option>
            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
          </select>
        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="location.href='/admin/upload.html'">æ·»åŠ æ¸¸æˆ</button>
        </div>
      </div>
      
      <!-- æç¤ºä¿¡æ¯åŒºåŸŸ -->
      <div id="alertContainer"></div>
      
      <!-- æ¸¸æˆåˆ—è¡¨ -->
      <div class="games-table-container">
        <table class="admin-table" id="gamesTable">
          <thead>
            <tr>
              <th style="width: 5%">ID</th>
              <th style="width: 15%">ç¼©ç•¥å›¾</th>
              <th style="width: 20%">æ ‡é¢˜</th>
              <th style="width: 30%">æè¿°</th>
              <th style="width: 10%">åˆ†ç±»</th>
              <th style="width: 10%">çŠ¶æ€</th>
              <th style="width: 10%">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="gamesTableBody">
            <!-- æ¸¸æˆåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
            <tr>
              <td colspan="7" class="loading">
                <div class="spinner"></div>
                <p>åŠ è½½æ¸¸æˆæ•°æ®ä¸­...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- æ¸¸æˆç¼–è¾‘å¯¹è¯æ¡† -->
    <div id="editGameModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ç¼–è¾‘æ¸¸æˆ</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <form id="editGameForm" class="admin-form">
            <input type="hidden" id="editGameId">
            
            <div class="form-group">
              <label for="editGameTitleZh">æ¸¸æˆæ ‡é¢˜ï¼ˆä¸­æ–‡ï¼‰</label>
              <input type="text" id="editGameTitleZh" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editGameTitleEn">æ¸¸æˆæ ‡é¢˜ï¼ˆè‹±æ–‡ï¼‰</label>
              <input type="text" id="editGameTitleEn" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editGameDescZh">æ¸¸æˆæè¿°ï¼ˆä¸­æ–‡ï¼‰</label>
              <textarea id="editGameDescZh" class="form-control" required></textarea>
            </div>
            
            <div class="form-group">
              <label for="editGameDescEn">æ¸¸æˆæè¿°ï¼ˆè‹±æ–‡ï¼‰</label>
              <textarea id="editGameDescEn" class="form-control" required></textarea>
            </div>
            
            <div class="form-group">
              <label for="editGameCategory">æ¸¸æˆåˆ†ç±»</label>
              <select id="editGameCategory" class="form-control" required>
                <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
              </select>
            </div>
            
            <div class="form-group">
              <label for="editGameUrl">æ¸¸æˆé“¾æ¥ (iframe URL)</label>
              <input type="url" id="editGameUrl" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editGameStatus">æ¸¸æˆçŠ¶æ€</label>
              <select id="editGameStatus" class="form-control">
                <option value="true">å¯ç”¨</option>
                <option value="false">ç¦ç”¨</option>
              </select>
            </div>
            
            <div class="form-group">
              <button type="submit" class="btn btn-primary">ä¿å­˜æ›´æ”¹</button>
              <button type="button" class="btn btn-secondary close-modal">å–æ¶ˆ</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- åˆ é™¤ç¡®è®¤å¯¹è¯æ¡† -->
    <div id="deleteConfirmModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ç¡®è®¤åˆ é™¤</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <p>æ‚¨ç¡®å®šè¦åˆ é™¤æ¸¸æˆ "<span id="deleteGameName"></span>" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</p>
          <div class="form-group">
            <button id="confirmDeleteBtn" class="btn btn-danger">ç¡®è®¤åˆ é™¤</button>
            <button class="btn btn-secondary close-modal">å–æ¶ˆ</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="/js/app.js"></script>
  <script src="/js/admin.js"></script>
  <script>
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
      
      if (!isLoggedIn) {
        // æœªç™»å½•ï¼Œæ˜¾ç¤ºè­¦å‘Š
        document.getElementById('loginAlert').style.display = 'block';
      } else {
        // å·²ç™»å½•ï¼Œæ˜¾ç¤ºæ¸¸æˆç®¡ç†é¢æ¿
        document.getElementById('gamesPanel').style.display = 'block';
        
        // åŠ è½½æ¸¸æˆæ•°æ®
        loadGamesList();
        
        // åˆå§‹åŒ–æœç´¢å’Œç­›é€‰åŠŸèƒ½
        initSearchAndFilter();
        
        // åˆå§‹åŒ–ç¼–è¾‘å¯¹è¯æ¡†
        initEditModal();
        
        // åˆå§‹åŒ–åˆ é™¤å¯¹è¯æ¡†
        initDeleteModal();
      }
      
      // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢æŒ‰é’®
      const toggleLangButton = document.getElementById('toggleLang');
      if (toggleLangButton) {
        toggleLangButton.addEventListener('click', toggleLanguage);
      }
    });
    
    /**
     * åŠ è½½æ¸¸æˆåˆ—è¡¨
     */
    function loadGamesList() {
      try {
        // æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€æ¸¸æˆæ•°æ®
        if (!window.gamesData || !Array.isArray(window.gamesData) || window.gamesData.length === 0) {
          // å¦‚æœå…¨å±€æ•°æ®ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œå°è¯•è·å–åº”ç”¨ä¸­çš„æ¸¸æˆæ•°æ®
          const builtInGames = [];
          if (window.appData && window.appData.games) {
            builtInGames.push(...window.appData.games);
          }
          
          // åŠ è½½è‡ªå®šä¹‰æ¸¸æˆæ•°æ®
          const customGamesStr = localStorage.getItem('customGames');
          const customGames = customGamesStr ? JSON.parse(customGamesStr) : [];
          
          // åˆå¹¶æ‰€æœ‰æ¸¸æˆæ•°æ®
          window.gamesData = [...builtInGames, ...customGames];
        }
        
        // æ¸²æŸ“æ¸¸æˆè¡¨æ ¼
        renderGamesTable(window.gamesData);
        
        // å¡«å……åˆ†ç±»ç­›é€‰å™¨
        populateCategoryFilter();
      } catch (error) {
        console.error('åŠ è½½æ¸¸æˆåˆ—è¡¨å¤±è´¥:', error);
        showAlert('åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚', 'danger');
      }
    }
    
    /**
     * æ¸²æŸ“æ¸¸æˆè¡¨æ ¼
     * @param {Array} games - æ¸¸æˆæ•°æ®æ•°ç»„
     */
    function renderGamesTable(games) {
      const tableBody = document.getElementById('gamesTableBody');
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      // æ¸…ç©ºè¡¨æ ¼å†…å®¹
      tableBody.innerHTML = '';
      
      if (!games || games.length === 0) {
        // å¦‚æœæ²¡æœ‰æ¸¸æˆï¼Œæ˜¾ç¤ºç©ºæ¶ˆæ¯
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="7" style="text-align: center; padding: 30px;">
            æš‚æ— æ¸¸æˆæ•°æ®ã€‚<a href="/admin/upload.html">ç‚¹å‡»è¿™é‡Œ</a>æ·»åŠ æ¸¸æˆã€‚
          </td>
        `;
        tableBody.appendChild(emptyRow);
        return;
      }
      
      // æŒ‰æ—¶é—´å€’åºæ’åˆ—æ¸¸æˆ
      const sortedGames = [...games].sort((a, b) => {
        return new Date(b.dateAdded || 0) - new Date(a.dateAdded || 0);
      });
      
      // ä¸ºæ¯ä¸ªæ¸¸æˆåˆ›å»ºè¡¨æ ¼è¡Œ
      sortedGames.forEach((game, index) => {
        const row = document.createElement('tr');
        row.dataset.gameId = game.id;
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªå®šä¹‰æ¸¸æˆï¼ˆå¯ç¼–è¾‘ï¼‰
        const isCustomGame = !!(localStorage.getItem('customGames') && 
          JSON.parse(localStorage.getItem('customGames')).find(g => g.id === game.id));
        
        // è·å–åˆ†ç±»åç§°
        let categoryName = 'æœªåˆ†ç±»';
        const category = window.categoriesData?.find(c => c.id === game.category);
        if (category && category.name) {
          categoryName = category.name[currentLang] || category.name.en || category.id;
        }
        
        // è®¾ç½®è¡Œå†…å®¹
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>
            <img src="${game.thumbnail || '/images/placeholder.jpg'}" alt="${game.title[currentLang]}" 
                 style="width: 80px; height: 60px; object-fit: cover; border-radius: 4px;">
          </td>
          <td>${game.title[currentLang] || game.title.en}</td>
          <td>${game.description[currentLang] || game.description.en}</td>
          <td>${categoryName}</td>
          <td>
            <span class="status-badge ${game.active ? 'status-active' : 'status-inactive'}">
              ${game.active ? 'å¯ç”¨' : 'ç¦ç”¨'}
            </span>
          </td>
          <td class="table-actions">
            <button class="btn btn-secondary btn-sm view-game" data-id="${game.id}" title="æŸ¥çœ‹æ¸¸æˆ">ğŸ‘ï¸</button>
            ${isCustomGame ? `
              <button class="btn btn-primary btn-sm edit-game" data-id="${game.id}" title="ç¼–è¾‘æ¸¸æˆ">âœï¸</button>
              <button class="btn btn-danger btn-sm delete-game" data-id="${game.id}" title="åˆ é™¤æ¸¸æˆ">ğŸ—‘ï¸</button>
            ` : `
              <button class="btn btn-secondary btn-sm" disabled title="å†…ç½®æ¸¸æˆæ— æ³•ä¿®æ”¹">ğŸ”’</button>
            `}
          </td>
        `;
        
        tableBody.appendChild(row);
      });
      
      // ä¸ºæŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      addTableButtonListeners();
    }
    
    /**
     * ä¸ºè¡¨æ ¼ä¸­çš„æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
     */
    function addTableButtonListeners() {
      // æŸ¥çœ‹æ¸¸æˆæŒ‰é’®
      document.querySelectorAll('.view-game').forEach(button => {
        button.addEventListener('click', function() {
          const gameId = this.dataset.id;
          window.open(`/game/index.html?id=${gameId}`, '_blank');
        });
      });
      
      // ç¼–è¾‘æ¸¸æˆæŒ‰é’®
      document.querySelectorAll('.edit-game').forEach(button => {
        button.addEventListener('click', function() {
          const gameId = this.dataset.id;
          openEditModal(gameId);
        });
      });
      
      // åˆ é™¤æ¸¸æˆæŒ‰é’®
      document.querySelectorAll('.delete-game').forEach(button => {
        button.addEventListener('click', function() {
          const gameId = this.dataset.id;
          openDeleteModal(gameId);
        });
      });
    }
    
    /**
     * å¡«å……åˆ†ç±»ç­›é€‰å™¨
     */
    function populateCategoryFilter() {
      const categoryFilter = document.getElementById('categoryFilter');
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      // å°è¯•è·å–åˆ†ç±»æ•°æ®
      let categories = [];
      if (window.categoriesData && Array.isArray(window.categoriesData)) {
        categories = window.categoriesData;
      } else if (window.appData && window.appData.categories) {
        categories = window.appData.categories;
      }
      
      // å¦‚æœæœ‰åˆ†ç±»æ•°æ®ï¼Œå¡«å……ä¸‹æ‹‰æ¡†
      if (categories.length > 0) {
        // ä¿ç•™ç¬¬ä¸€ä¸ª"å…¨éƒ¨åˆ†ç±»"é€‰é¡¹
        categoryFilter.innerHTML = `<option value="">å…¨éƒ¨åˆ†ç±»</option>`;
        
        // æ·»åŠ æ¯ä¸ªåˆ†ç±»ä½œä¸ºé€‰é¡¹
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category.id;
          option.textContent = category.name[currentLang] || category.name.en || category.id;
          categoryFilter.appendChild(option);
        });
        
        // åŒæ ·å¡«å……ç¼–è¾‘è¡¨å•çš„åˆ†ç±»é€‰æ‹©å™¨
        const editCategorySelect = document.getElementById('editGameCategory');
        if (editCategorySelect) {
          editCategorySelect.innerHTML = '';
          categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name[currentLang] || category.name.en || category.id;
            editCategorySelect.appendChild(option);
          });
        }
      }
    }
    
    /**
     * åˆå§‹åŒ–æœç´¢å’Œç­›é€‰åŠŸèƒ½
     */
    function initSearchAndFilter() {
      // æœç´¢åŠŸèƒ½
      const searchInput = document.getElementById('searchGames');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          applyFilters();
        });
      }
      
      // åˆ†ç±»ç­›é€‰
      const categoryFilter = document.getElementById('categoryFilter');
      if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
          applyFilters();
        });
      }
    }
    
    /**
     * åº”ç”¨æœç´¢å’Œç­›é€‰æ¡ä»¶
     */
    function applyFilters() {
      const searchTerm = document.getElementById('searchGames').value.toLowerCase();
      const categoryValue = document.getElementById('categoryFilter').value;
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      // å¤åˆ¶åŸå§‹æ¸¸æˆæ•°æ®è¿›è¡Œç­›é€‰
      let filteredGames = [...window.gamesData];
      
      // åº”ç”¨æœç´¢æ¡ä»¶
      if (searchTerm) {
        filteredGames = filteredGames.filter(game => {
          // åœ¨æ ‡é¢˜å’Œæè¿°ä¸­æœç´¢
          const titleMatch = game.title[currentLang]?.toLowerCase().includes(searchTerm) || 
                           game.title.en?.toLowerCase().includes(searchTerm);
          
          const descMatch = game.description[currentLang]?.toLowerCase().includes(searchTerm) || 
                          game.description.en?.toLowerCase().includes(searchTerm);
                          
          return titleMatch || descMatch;
        });
      }
      
      // åº”ç”¨åˆ†ç±»ç­›é€‰
      if (categoryValue) {
        filteredGames = filteredGames.filter(game => game.category === categoryValue);
      }
      
      // é‡æ–°æ¸²æŸ“è¡¨æ ¼
      renderGamesTable(filteredGames);
    }
    
    /**
     * åˆå§‹åŒ–ç¼–è¾‘å¯¹è¯æ¡†
     */
    function initEditModal() {
      // è·å–å¯¹è¯æ¡†å…ƒç´ 
      const modal = document.getElementById('editGameModal');
      
      // å…³é—­æŒ‰é’®äº‹ä»¶
      const closeButtons = modal.querySelectorAll('.close-modal');
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          modal.style.display = 'none';
        });
      });
      
      // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
      window.addEventListener('click', function(event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
      
      // è¡¨å•æäº¤äº‹ä»¶
      const form = document.getElementById('editGameForm');
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        saveGameChanges();
      });
    }
    
    /**
     * æ‰“å¼€ç¼–è¾‘æ¸¸æˆå¯¹è¯æ¡†
     * @param {string} gameId - æ¸¸æˆID
     */
    function openEditModal(gameId) {
      // è·å–è¦ç¼–è¾‘çš„æ¸¸æˆæ•°æ®
      const game = window.gamesData.find(g => g.id === gameId);
      if (!game) {
        showAlert('æœªæ‰¾åˆ°æ¸¸æˆæ•°æ®', 'danger');
        return;
      }
      
      // å¡«å……è¡¨å•å­—æ®µ
      document.getElementById('editGameId').value = game.id;
      document.getElementById('editGameTitleZh').value = game.title.zh || '';
      document.getElementById('editGameTitleEn').value = game.title.en || '';
      document.getElementById('editGameDescZh').value = game.description.zh || '';
      document.getElementById('editGameDescEn').value = game.description.en || '';
      document.getElementById('editGameCategory').value = game.category || '';
      document.getElementById('editGameUrl').value = game.iframeUrl || '';
      document.getElementById('editGameStatus').value = game.active.toString();
      
      // æ˜¾ç¤ºå¯¹è¯æ¡†
      document.getElementById('editGameModal').style.display = 'block';
    }
    
    /**
     * ä¿å­˜æ¸¸æˆç¼–è¾‘æ›´æ”¹
     */
    function saveGameChanges() {
      // è·å–è¡¨å•æ•°æ®
      const gameId = document.getElementById('editGameId').value;
      
      // å‡†å¤‡æ›´æ–°åçš„æ¸¸æˆæ•°æ®
      const updatedGame = {
        id: gameId,
        title: {
          zh: document.getElementById('editGameTitleZh').value,
          en: document.getElementById('editGameTitleEn').value
        },
        description: {
          zh: document.getElementById('editGameDescZh').value,
          en: document.getElementById('editGameDescEn').value
        },
        category: document.getElementById('editGameCategory').value,
        iframeUrl: document.getElementById('editGameUrl').value,
        active: document.getElementById('editGameStatus').value === 'true',
        dateModified: new Date().toISOString()
      };
      
      try {
        // è·å–è‡ªå®šä¹‰æ¸¸æˆåˆ—è¡¨
        const customGames = JSON.parse(localStorage.getItem('customGames') || '[]');
        
        // æŸ¥æ‰¾è¦æ›´æ–°çš„æ¸¸æˆç´¢å¼•
        const gameIndex = customGames.findIndex(g => g.id === gameId);
        
        if (gameIndex === -1) {
          showAlert('æœªæ‰¾åˆ°è¦æ›´æ–°çš„æ¸¸æˆ', 'danger');
          return;
        }
        
        // ä¿ç•™åŸå§‹æ¸¸æˆå¯¹è±¡ä¸­çš„å…¶ä»–å­—æ®µ
        const originalGame = customGames[gameIndex];
        
        // åˆå¹¶æ›´æ–°
        customGames[gameIndex] = {
          ...originalGame,
          ...updatedGame,
          dateAdded: originalGame.dateAdded, // ä¿ç•™åŸæ·»åŠ æ—¥æœŸ
          thumbnail: originalGame.thumbnail // ä¿ç•™åŸç¼©ç•¥å›¾
        };
        
        // ä¿å­˜å›æœ¬åœ°å­˜å‚¨
        localStorage.setItem('customGames', JSON.stringify(customGames));
        
        // æ›´æ–°å…¨å±€æ¸¸æˆæ•°æ®
        const globalGameIndex = window.gamesData.findIndex(g => g.id === gameId);
        if (globalGameIndex !== -1) {
          window.gamesData[globalGameIndex] = customGames[gameIndex];
        }
        
        // å…³é—­å¯¹è¯æ¡†
        document.getElementById('editGameModal').style.display = 'none';
        
        // åˆ·æ–°è¡¨æ ¼
        renderGamesTable(window.gamesData);
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showAlert('æ¸¸æˆä¿¡æ¯å·²æˆåŠŸæ›´æ–°ï¼', 'success');
      } catch (error) {
        console.error('ä¿å­˜æ¸¸æˆæ›´æ”¹å¤±è´¥:', error);
        showAlert('ä¿å­˜æ¸¸æˆæ›´æ”¹å¤±è´¥ã€‚', 'danger');
      }
    }
    
    /**
     * åˆå§‹åŒ–åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
     */
    function initDeleteModal() {
      // è·å–å¯¹è¯æ¡†å…ƒç´ 
      const modal = document.getElementById('deleteConfirmModal');
      
      // å…³é—­æŒ‰é’®äº‹ä»¶
      const closeButtons = modal.querySelectorAll('.close-modal');
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          modal.style.display = 'none';
        });
      });
      
      // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
      window.addEventListener('click', function(event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
      
      // ç¡®è®¤åˆ é™¤æŒ‰é’®äº‹ä»¶
      const confirmButton = document.getElementById('confirmDeleteBtn');
      confirmButton.addEventListener('click', function() {
        deleteGame(this.dataset.gameId);
      });
    }
    
    /**
     * æ‰“å¼€åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
     * @param {string} gameId - æ¸¸æˆID
     */
    function openDeleteModal(gameId) {
      // è·å–è¦åˆ é™¤çš„æ¸¸æˆæ•°æ®
      const game = window.gamesData.find(g => g.id === gameId);
      if (!game) {
        showAlert('æœªæ‰¾åˆ°æ¸¸æˆæ•°æ®', 'danger');
        return;
      }
      
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      // è®¾ç½®æ¸¸æˆåç§°
      document.getElementById('deleteGameName').textContent = game.title[currentLang] || game.title.en;
      
      // è®¾ç½®ç¡®è®¤æŒ‰é’®çš„æ¸¸æˆID
      document.getElementById('confirmDeleteBtn').dataset.gameId = gameId;
      
      // æ˜¾ç¤ºå¯¹è¯æ¡†
      document.getElementById('deleteConfirmModal').style.display = 'block';
    }
    
    /**
     * åˆ é™¤æ¸¸æˆ
     * @param {string} gameId - æ¸¸æˆID
     */
    function deleteGame(gameId) {
      try {
        // è·å–è‡ªå®šä¹‰æ¸¸æˆåˆ—è¡¨
        const customGames = JSON.parse(localStorage.getItem('customGames') || '[]');
        
        // æŸ¥æ‰¾è¦åˆ é™¤çš„æ¸¸æˆç´¢å¼•
        const gameIndex = customGames.findIndex(g => g.id === gameId);
        
        if (gameIndex === -1) {
          showAlert('æœªæ‰¾åˆ°è¦åˆ é™¤çš„æ¸¸æˆ', 'danger');
          return;
        }
        
        // åˆ é™¤æ¸¸æˆ
        customGames.splice(gameIndex, 1);
        
        // ä¿å­˜å›æœ¬åœ°å­˜å‚¨
        localStorage.setItem('customGames', JSON.stringify(customGames));
        
        // æ›´æ–°å…¨å±€æ¸¸æˆæ•°æ®
        window.gamesData = window.gamesData.filter(g => g.id !== gameId);
        
        // å…³é—­å¯¹è¯æ¡†
        document.getElementById('deleteConfirmModal').style.display = 'none';
        
        // åˆ·æ–°è¡¨æ ¼
        renderGamesTable(window.gamesData);
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showAlert('æ¸¸æˆå·²æˆåŠŸåˆ é™¤ï¼', 'success');
      } catch (error) {
        console.error('åˆ é™¤æ¸¸æˆå¤±è´¥:', error);
        showAlert('åˆ é™¤æ¸¸æˆå¤±è´¥ã€‚', 'danger');
      }
    }
    
    /**
     * æ˜¾ç¤ºæé†’æ¶ˆæ¯
     * @param {string} message - æ¶ˆæ¯æ–‡æœ¬
     * @param {string} type - æ¶ˆæ¯ç±»å‹ (success, danger, warning, info)
     */
    function showAlert(message, type) {
      const alertContainer = document.getElementById('alertContainer');
      
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      
      // æ·»åŠ å…³é—­æŒ‰é’®
      const closeBtn = document.createElement('span');
      closeBtn.style.float = 'right';
      closeBtn.style.cursor = 'pointer';
      closeBtn.textContent = 'Ã—';
      closeBtn.addEventListener('click', function() {
        alert.remove();
      });
      
      alert.appendChild(closeBtn);
      alertContainer.prepend(alert);
      
      // 5ç§’åè‡ªåŠ¨å…³é—­
      setTimeout(function() {
        if (alert.parentNode) {
          alert.remove();
        }
      }, 5000);
    }
    
    /**
     * åˆ‡æ¢ç•Œé¢è¯­è¨€
     */
    function toggleLanguage() {
      // è·å–å½“å‰è¯­è¨€
      let currentLang = localStorage.getItem('locale') || 'zh';
      
      // åˆ‡æ¢è¯­è¨€
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('locale', currentLang);
      
      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      document.getElementById('toggleLang').textContent = currentLang === 'zh' ? 'English' : 'ä¸­æ–‡';
      
      // åˆ·æ–°é¡µé¢æ˜¾ç¤º
      populateCategoryFilter();
      renderGamesTable(window.gamesData);
      updateUIText();
    }
    
    /**
     * æ›´æ–°ç•Œé¢æ–‡æœ¬
     */
    function updateUIText() {
      const currentLang = localStorage.getItem('locale') || 'zh';
      
      const translations = {
        zh: {
          'games.title': 'AI Stone æ¸¸æˆå¯¼èˆª - æ¸¸æˆç®¡ç†',
          'games.heading': 'æ¸¸æˆç®¡ç†',
          'games.search': 'æœç´¢æ¸¸æˆ...',
          'games.all.categories': 'å…¨éƒ¨åˆ†ç±»',
          'games.add': 'æ·»åŠ æ¸¸æˆ',
          'games.loading': 'åŠ è½½æ¸¸æˆæ•°æ®ä¸­...',
          'games.empty': 'æš‚æ— æ¸¸æˆæ•°æ®ã€‚',
          'games.click.here': 'ç‚¹å‡»è¿™é‡Œ',
          'games.add.game': 'æ·»åŠ æ¸¸æˆã€‚',
          'games.status.active': 'å¯ç”¨',
          'games.status.inactive': 'ç¦ç”¨',
          'games.action.view': 'æŸ¥çœ‹æ¸¸æˆ',
          'games.action.edit': 'ç¼–è¾‘æ¸¸æˆ',
          'games.action.delete': 'åˆ é™¤æ¸¸æˆ',
          'games.builtin': 'å†…ç½®æ¸¸æˆæ— æ³•ä¿®æ”¹',
          'games.edit.title': 'ç¼–è¾‘æ¸¸æˆ',
          'games.save': 'ä¿å­˜æ›´æ”¹',
          'games.cancel': 'å–æ¶ˆ',
          'games.delete.confirm': 'ç¡®è®¤åˆ é™¤',
          'games.delete.message': 'æ‚¨ç¡®å®šè¦åˆ é™¤æ¸¸æˆ "',
          'games.delete.message2': '" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚',
          'games.confirm.delete': 'ç¡®è®¤åˆ é™¤',
          'nav.home': 'é¦–é¡µ',
          'nav.favorites': 'æ”¶è—å¤¹',
          'nav.admin': 'ç®¡ç†'
        },
        en: {
          'games.title': 'AI Stone Game Navigation - Game Management',
          'games.heading': 'Game Management',
          'games.search': 'Search games...',
          'games.all.categories': 'All Categories',
          'games.add': 'Add Game',
          'games.loading': 'Loading game data...',
          'games.empty': 'No games available.',
          'games.click.here': 'Click here',
          'games.add.game': ' to add a game.',
          'games.status.active': 'Active',
          'games.status.inactive': 'Inactive',
          'games.action.view': 'View Game',
          'games.action.edit': 'Edit Game',
          'games.action.delete': 'Delete Game',
          'games.builtin': 'Built-in game cannot be modified',
          'games.edit.title': 'Edit Game',
          'games.save': 'Save Changes',
          'games.cancel': 'Cancel',
          'games.delete.confirm': 'Confirm Deletion',
          'games.delete.message': 'Are you sure you want to delete the game "',
          'games.delete.message2': '"? This action cannot be undone.',
          'games.confirm.delete': 'Confirm Delete',
          'nav.home': 'Home',
          'nav.favorites': 'Favorites',
          'nav.admin': 'Admin'
        }
      };
      
      // è®¾ç½®é¡µé¢æ ‡é¢˜
      document.title = translations[currentLang]['games.title'];
      document.querySelector('.site-title').textContent = translations[currentLang]['games.title'];
      
      // æ›´æ–°å¯¼èˆªé“¾æ¥
      const navLinks = document.querySelectorAll('.main-nav a');
      navLinks[0].textContent = translations[currentLang]['nav.home'];
      navLinks[1].textContent = translations[currentLang]['nav.favorites'];
      navLinks[2].textContent = translations[currentLang]['nav.admin'];
      
      // æ›´æ–°é¡µé¢æ ‡é¢˜
      document.querySelector('.admin-title').textContent = translations[currentLang]['games.heading'];
      
      // æ›´æ–°æœç´¢æ¡†å ä½ç¬¦
      document.getElementById('searchGames').placeholder = translations[currentLang]['games.search'];
      
      // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨ç¬¬ä¸€ä¸ªé€‰é¡¹
      document.querySelector('#categoryFilter option:first-child').textContent = 
        translations[currentLang]['games.all.categories'];
      
      // æ›´æ–°æ·»åŠ æ¸¸æˆæŒ‰é’®
      document.querySelector('.action-buttons .btn-primary').textContent = 
        translations[currentLang]['games.add'];
        
      // æ›´æ–°æ¸¸æˆçŠ¶æ€æ–‡æœ¬
      document.querySelectorAll('.status-active').forEach(el => {
        el.textContent = translations[currentLang]['games.status.active'];
      });
      
      document.querySelectorAll('.status-inactive').forEach(el => {
        el.textContent = translations[currentLang]['games.status.inactive'];
      });
      
      // æ›´æ–°å¯¹è¯æ¡†æ–‡æœ¬
      if (document.querySelector('#editGameModal .modal-header h3')) {
        document.querySelector('#editGameModal .modal-header h3').textContent = 
          translations[currentLang]['games.edit.title'];
      }
      
      if (document.querySelector('#editGameForm .btn-primary')) {
        document.querySelector('#editGameForm .btn-primary').textContent = 
          translations[currentLang]['games.save'];
      }
      
      if (document.querySelector('#editGameForm .btn-secondary')) {
        document.querySelector('#editGameForm .btn-secondary').textContent = 
          translations[currentLang]['games.cancel'];
      }
      
      // æ›´æ–°åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
      if (document.querySelector('#deleteConfirmModal .modal-header h3')) {
        document.querySelector('#deleteConfirmModal .modal-header h3').textContent = 
          translations[currentLang]['games.delete.confirm'];
      }
      
      const deleteMessageParts = document.querySelector('#deleteConfirmModal .modal-body p');
      if (deleteMessageParts) {
        deleteMessageParts.innerHTML = 
          translations[currentLang]['games.delete.message'] + 
          `<span id="deleteGameName"></span>` + 
          translations[currentLang]['games.delete.message2'];
      }
      
      if (document.querySelector('#confirmDeleteBtn')) {
        document.querySelector('#confirmDeleteBtn').textContent = 
          translations[currentLang]['games.confirm.delete'];
      }
      
      if (document.querySelector('#deleteConfirmModal .btn-secondary')) {
        document.querySelector('#deleteConfirmModal .btn-secondary').textContent = 
          translations[currentLang]['games.cancel'];
      }
    }
  </script>
</body>
</html> 