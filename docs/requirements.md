# Stone Games 游戏导航网站需求文档

> **文档更新说明**：本文档已于当前日期更新，根据项目实际实现状态调整了技术方案、部署流程和项目功能说明。请以本文档为准进行后续开发。

## 项目概述

Stone Games是一个简单的游戏导航网站，通过iframe方式嵌入各种网页游戏，为用户提供便捷的游戏发现和体验平台。网站默认提供英文界面，同时支持中文语言切换，便于全球用户访问。

## 项目目标

1. 创建一个简洁易用的游戏导航平台
2. 通过iframe无缝嵌入网页游戏
3. 提供多语言支持（默认英文，支持中文）
4. 实现便捷的管理员后台，方便游戏内容管理
5. 部署在Cloudflare Pages上并绑定aistone.org域名

## 核心功能需求

### 用户端功能

1. **首页展示**
   - 游戏列表（图片+名称+简介）
   - 游戏分类导航
   - 语言切换功能（英文/中文）
   - 响应式设计（适配移动端和桌面端）

2. **游戏页面**
   - iframe游戏嵌入
   - 游戏信息展示
   - 返回首页功能
   - 全屏/调整尺寸选项

### 管理员功能

1. **管理员登录**
   - 安全的登录界面
   - 会话管理

2. **游戏管理**
   - 添加新游戏（表单提交）
   - 编辑现有游戏信息
   - 删除游戏
   - 设置游戏发布状态（显示/隐藏）

3. **分类管理**
   - 创建/编辑/删除游戏分类
   - 设置中英文分类名称

## 技术方案

### 前端技术栈
- Next.js框架（使用静态导出模式`output: 'export'`）
- React组件库
- TypeScript
- Tailwind CSS样式框架
- 自定义实现的i18n国际化方案（非next-i18next）
  - 使用自定义hooks管理翻译
  - 翻译文件位于public/locales/[语言代码]/common.json
  - 通过localStorage保存用户语言偏好

### 数据管理
- 目前使用内存中的硬编码数据（app/data/games.ts）
- 计划未来使用JSON文件或轻量级数据库存储
- 可能实现Next.js API Routes数据接口

### 部署环境
- GitHub代码仓库
- GitHub账号: [@peyoba](https://github.com/peyoba)
- Cloudflare Pages托管
- 自定义域名：aistone.org
- 静态站点生成（Static Site Generation）

## 数据结构

### 游戏数据
```json
{
  "id": "unique-game-id",
  "title": {
    "en": "Game Title in English",
    "zh": "游戏中文标题"
  },
  "description": {
    "en": "Game description in English",
    "zh": "游戏中文描述"
  },
  "iframeUrl": "https://example.com/game-url",
  "thumbnail": "/images/game-thumbnail.jpg",
  "category": "category-id",
  "active": true,
  "dateAdded": "2023-06-01T12:00:00Z"
}
```

### 分类数据
```json
{
  "id": "category-id",
  "name": {
    "en": "Category Name in English",
    "zh": "分类中文名称"
  },
  "order": 1,
  "active": true
}
```

## 开发计划与时间线

### 第一阶段：MVP核心功能（2周）

#### 第1周：基础框架搭建
- 创建Next.js项目框架
- 设计英文默认界面
- 实现中英文国际化框架
- 设计简洁的首页布局
- 实现基础导航组件
- 配置Cloudflare Pages部署环境

#### 第2周：核心功能实现
- 游戏卡片组件开发
- iframe嵌入功能实现
- 简单分类系统开发
- 响应式适配（移动端/桌面端）
- 管理员界面原型开发

### 第二阶段：管理功能（1周）
- 创建管理员登录界面
- 开发游戏管理功能
  - 添加新游戏表单
  - 编辑现有游戏
  - 删除游戏
- 开发游戏iframe链接上传功能
- 中英文内容管理系统

### 第三阶段：测试与部署（1周）
- 功能测试与Bug修复
- 性能优化
- Cloudflare Pages配置
- 域名绑定与DNS设置
- 上线发布

## 部署流程

1. 代码推送到GitHub仓库
2. GitHub Actions自动构建
3. 部署到Cloudflare Pages
   - 构建命令: 
     - Windows: `npm run build:win`
     - Linux: `npm run build` 或 `npm run build:linux`
   - 输出目录: `out`（非`.next`）
   - 配置文件: `public/cloudflare-deploy-config.json`
4. 绑定aistone.org域名
   - 在Cloudflare Pages控制台添加自定义域名
   - 配置相应的DNS记录
   - 使用_routes.json和_redirects文件定义路由行为

## 后期迭代计划

### 第二版（用户体验提升）
- 搜索功能
- 游戏详情页面增强
- 游戏评分系统
- 本地收藏功能

### 第三版（社区功能）
- 用户账户系统
- 评论功能
- 收藏与历史记录云同步
- 游戏推荐算法

### 第四版（运营与变现）
- 多语言支持扩展
- 数据分析工具集成
- 广告接入
- 热门游戏推广位

## 验收标准

1. 网站能够正常展示游戏列表和分类
2. 成功嵌入外部游戏iframe并正常运行
3. 语言切换功能正常工作（默认英文，可切换中文）
4. 管理员能够添加、编辑和删除游戏
5. 网站在移动端和桌面端都能良好展示
6. 成功部署到Cloudflare Pages并通过aistone.org域名访问

## 部署最佳实践

为避免部署过程中可能遇到的问题，特总结以下最佳实践和注意事项：

### 项目初始化

1. **使用官方工具创建项目**
   - 使用`npx create-next-app`初始化项目，确保基础配置正确
   - 选择正确的选项：TypeScript、ESLint、Tailwind CSS等
   - 不要手动修改核心配置文件，除非明确知道改动的影响

2. **依赖包管理**
   - 确保`package.json`中不包含不存在的或废弃的依赖包
   - 定期更新依赖包以避免安全问题
   - 避免使用非官方或维护不活跃的依赖包

3. **配置文件正确性**
   - Next.js配置使用`next.config.js`或`next.config.mjs`，不要使用`.ts`格式
   - Tailwind配置需包含正确的`content`路径设置
   - PostCSS配置使用标准格式：`{ plugins: { tailwindcss: {}, autoprefixer: {} } }`

### TypeScript配置

1. **合理的类型检查级别**
   - 项目初期考虑使用较宽松的设置：`"strict": false`
   - 随着项目成熟可逐步增加严格度
   - 始终为函数添加明确的返回类型注解，特别是异步函数

2. **类型定义完整性**
   - 确保所有组件和函数都有适当的类型定义
   - 避免过度使用`any`类型
   - 对第三方库缺少类型定义的情况，添加自定义声明文件

### 构建与部署流程

1. **本地验证**
   - 每次提交前在本地运行完整构建：`npm run build`
   - 修复所有编译错误和TypeScript错误
   - 测试生产环境构建结果

2. **Cloudflare Pages特定配置**
   - 使用正确的构建命令：`npm run build`
   - 设置输出目录为：`.next`
   - 添加环境变量：`NODE_VERSION=18.x`或更高版本
   - 考虑添加`wrangler.toml`文件进行更精细的控制

3. **渐进式问题解决**
   - 解决一个问题后检查是否引入了新问题
   - 采用小步迭代的方式解决问题，而不是大规模修改
   - 保持提交历史清晰，每次提交解决一个具体问题

### 常见问题及解决方案

1. **依赖问题**
   - 症状：`npm ERR! code ETARGET`或找不到模块错误
   - 解决：检查`package.json`中的依赖是否存在或版本是否正确

2. **配置文件格式错误**
   - 症状：`Error: Configuring Next.js via 'next.config.ts' is not supported`
   - 解决：将配置文件转换为`.js`或`.mjs`格式

3. **TypeScript类型错误**
   - 症状：`implicitly has return type 'any'`或类型不匹配错误
   - 解决：添加明确的类型注解，或放宽TypeScript配置

4. **Tailwind CSS问题**
   - 症状：`The content option in your Tailwind CSS configuration is missing or empty`
   - 解决：在`tailwind.config.js`中正确配置内容路径

5. **i18n国际化问题**
   - 症状：翻译函数返回类型错误
   - 解决：确保翻译函数返回的是字符串类型，并添加类型保护

通过遵循以上最佳实践，可以显著减少部署过程中遇到的问题，提高开发效率和代码质量

## 部署经验与问题解决总结

在项目部署过程中，我们遇到了一系列问题并积累了宝贵的经验。以下是对遇到的问题和解决方案的总结，可作为今后项目部署的参考。

### 1. Next.js框架与Cloudflare Pages兼容性问题

#### 问题描述
- Next.js默认的SSR渲染模式与Cloudflare Pages不兼容
- 尝试使用`output: 'export'`静态导出模式时，与动态路由和i18n配置冲突
- 构建成功但访问网站时出现404错误

#### 解决方案
- 放弃使用Next.js的服务端功能，转为纯静态网站
- 直接创建HTML、CSS和JavaScript文件放在`public`目录
- 使用简化的构建命令：`mkdir -p out && cp -r public/* out/`
- 添加`_redirects`文件配置所有路径重定向到首页：`/* /index.html 200`

### 2. 平台兼容性问题

#### 问题描述
- 本地开发使用Windows，而Cloudflare Pages使用Linux环境
- Windows特有的命令如`xcopy`在Linux构建环境中不可用
- 文件路径分隔符不同（Windows使用`\`，Linux使用`/`）

#### 解决方案
- 使用跨平台兼容的命令，如`mkdir -p`和`cp -r`
- 避免使用平台特定的命令和路径格式
- 在`package.json`中使用Linux风格的命令，确保在Cloudflare构建环境中正常工作

### 3. 静态导出与动态路由冲突

#### 问题描述
- Next.js的`[id]`格式动态路由需要在静态导出时生成所有可能的路径
- `generateStaticParams()`函数需要在Server Component中使用
- 使用`'use client'`的Client Component不能同时使用`generateStaticParams()`

#### 解决方案
- 分离客户端和服务端组件，创建纯服务端的路由组件和纯客户端的UI组件
- 最终决定放弃Next.js路由系统，使用纯HTML和前端路由
- 使用静态HTML中的锚点链接（`#`）替代动态路由

### 4. 构建与部署流程优化

#### 问题描述
- 复杂的构建流程增加了失败风险
- 每次修改后需要重新构建和部署，影响开发效率
- 文件复制和路径配置容易出错

#### 解决方案
- 极度简化构建流程，直接复制静态文件而不执行复杂的构建步骤
- 添加备用构建命令，以防主命令失败
- 使用Cloudflare Pages的自定义部署配置文件(`cloudflare-deploy-config.json`)

### 5. 环境差异与配置管理

#### 问题描述
- 本地开发环境与生产环境配置差异大
- 缺少明确的环境变量和配置管理
- 同一套代码需要适应不同环境

#### 解决方案
- 创建环境特定的配置文件
- 使用条件判断加载不同环境的配置
- 简化依赖项，减少环境依赖问题

### 经验教训与最佳实践

1. **简化优先原则**
   - 在技术选型时优先考虑简单可靠的解决方案
   - 避免过度工程化，特别是对于小型项目
   - 当遇到复杂框架问题时，考虑使用更简单的替代方案

2. **渐进式开发与测试**
   - 每个重要改动后进行构建测试
   - 采用小步迭代而非大规模修改
   - 保持清晰的提交历史，便于追踪问题

3. **平台兼容性考虑**
   - 始终使用跨平台兼容的命令和工具
   - 避免依赖特定操作系统的功能
   - 测试脚本在不同环境中的执行情况

4. **备份与回退策略**
   - 保留功能正常的版本作为备份
   - 制定明确的回退计划
   - 对关键配置文件进行版本控制

5. **文档与知识沉淀**
   - 记录所有重要的配置修改和问题解决方案
   - 创建详细的部署文档
   - 分享经验教训，避免团队成员重复踩坑

通过这次部署经历，我们不仅成功部署了网站，也积累了宝贵的经验。这些经验对于未来的项目开发和部署将提供重要的参考价值

## 项目当前状态

以下是对项目当前实现状态的总结，这些信息可能与原计划有所不同：

### 前端实现

1. **页面结构**
   - 主页（首页）已实现基础结构
   - 游戏详情页已创建基本结构，支持iframe嵌入
   - 管理员面板已有基本UI，但功能不完整
   - 所有页面都已配置响应式设计

2. **组件开发**
   - 已实现游戏卡片组件（GameCard）
   - 已实现游戏列表组件（GameGrid）
   - 已实现游戏播放器组件（GamePlayer）
   - 已实现基础布局组件（Layout）

3. **国际化状态**
   - 使用自定义i18n实现，而非next-i18next
   - 英文和中文翻译文件位于public/locales目录下
   - 用户语言设置保存在localStorage中，非服务端实现

### 部署配置特性

1. **静态导出模式**
   - 项目使用Next.js的静态导出功能（`output: 'export'`）
   - 构建过程主要是将public目录内容复制到out目录
   - 未实际执行Next.js标准构建流程

2. **Cloudflare Pages路由**
   - 所有/game/*路径都重定向到/game/index.html
   - 所有/admin/*路径都重定向到/admin/index.html
   - 配置了404页面处理

### 管理功能现状

1. **管理员登录**
   - 使用localStorage存储登录状态的简单实现
   - 缺乏服务端认证和安全措施

2. **游戏管理**
   - 已实现基本UI界面
   - 游戏状态切换（显示/隐藏）仅在当前会话中有效
   - 数据修改不会持久化保存

3. **数据持久化**
   - 当前所有数据存储在内存中，页面刷新后会重置

### 需要优先解决的问题

1. **构建流程改进**
   - 目前的构建流程只是复制public目录到out目录，没有实际执行Next.js构建
   - 构建脚本需要修改为：
     ```json
     "build": "next build && next export -o out && cp _routes.json out/_routes.json",
     "build:win": "next build && next export -o out && copy _routes.json out\\_routes.json"
     ```
   - 确保Next.js组件被正确静态生成
   - 处理Windows和Linux环境下的跨平台兼容性问题

2. **数据管理实现**
   - 考虑使用JSON文件存储或轻量级数据库
   - 实现简单的数据持久化机制

3. **管理功能完善**
   - 实现真正的管理员认证系统
   - 完成游戏添加和编辑功能
   - 实现数据修改的持久化存储

4. **资源完善**
   - 添加游戏缩略图和图片资源
   - 完善多语言翻译内容

这些状态信息反映了项目的实际情况，开发人员应参考这些信息而非原计划中的假设。

## 响应式设计要求

为确保网站在不同设备上都有良好的用户体验，响应式设计是首要考虑因素：

### 桌面端（>= 1024px）
1. **布局与导航**
   - 多列游戏卡片网格（每行3-4个）
   - 水平菜单栏
   - 侧边栏分类展示
   - 更大的游戏画面

2. **交互体验**
   - 悬停效果
   - 键盘导航支持
   - 大尺寸游戏iframe

### 平板端（768px - 1023px）
1. **布局调整**
   - 2-3列游戏卡片
   - 折叠式导航菜单
   - 优化触摸区域大小

2. **游戏体验**
   - 自适应游戏窗口
   - 横向和纵向模式支持

### 移动端（< 768px）
1. **布局与导航**
   - 单列或双列游戏卡片
   - 汉堡菜单导航
   - 简化的页面元素
   - 触摸友好的按钮（至少44x44像素）

2. **游戏体验**
   - 自动全屏游戏
   - 简化的控制界面
   - 优化触摸交互

### 通用响应式设计原则
1. **流体网格**
   - 使用百分比而非固定宽度
   - 运用CSS Grid和Flexbox布局

2. **灵活的图像**
   - 使用max-width: 100%确保图像不溢出容器
   - 根据设备分辨率提供不同尺寸的图像

3. **媒体查询**
   - 针对不同屏幕尺寸设置断点
   - 调整字体大小、间距和组件尺寸

4. **触摸优化**
   - 所有可交互元素提供足够大的触摸区域
   - 避免依赖悬停状态的功能
   - 考虑触摸手势交互

5. **性能考虑**
   - 移动端减少不必要的动画和效果
   - 优化图像和资源加载
   - 实现渐进式加载

## 技术实现方案

### 前端开发推荐方案
考虑到项目已简化为静态网站，推荐以下方案：

1. **继续使用纯HTML/CSS/JavaScript**
   - 优点：简单、轻量、易于部署
   - 缺点：功能受限，代码组织不够优雅
   
2. **引入Alpine.js或HTMx等轻量库**
   - 优点：保持简单性的同时增强交互功能
   - 缺点：仍需手动管理状态和路由

### 数据管理方案

1. **JSON文件存储**
   - 游戏数据存储在`/public/data/games.json`
   - 分类数据存储在`/public/data/categories.json`
   - 通过fetch API加载数据

2. **管理员数据持久化**
   - 使用GitHub API更新仓库中的JSON文件
   - 或使用Cloudflare KV存储(需要Cloudflare Workers)

## 文件结构规划

```
/
├── public/
│   ├── index.html       # 首页
│   ├── admin/           # 管理后台页面
│   │   ├── index.html   # 管理首页
│   │   ├── login.html   # 登录页面
│   │   ├── games.html   # 游戏管理
│   │   └── categories.html # 分类管理
│   ├── game/            # 游戏页面目录
│   │   └── index.html   # 动态游戏页面
│   ├── search.html      # 搜索页面
│   ├── favorites.html   # 收藏页面
│   ├── css/             # 样式文件
│   ├── js/              # 脚本文件
│   ├── images/          # 图片资源
│   └── data/            # 数据文件
│       ├── games.json   # 游戏数据
│       └── categories.json # 分类数据
└── docs/
    └── requirements.md  # 项目需求文档
```

## 开发与部署流程

1. **本地开发**
   - 使用Live Server或简单的HTTP服务器进行开发
   - 保持HTML文件结构清晰，添加详细注释
   - 在多种设备和浏览器上测试响应式设计

2. **部署流程**
   - 使用当前的`build`脚本复制静态文件到`out`目录
   - 通过Cloudflare Pages自动部署
   - 部署后在多个设备上验证网站表现

3. **持续优化**
   - 收集用户使用数据和反馈
   - 定期更新和改进用户界面
   - 优化移动端和桌面端的用户体验 